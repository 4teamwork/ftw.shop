<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="ftw.shop">
<body>

<metal:main fill-slot="main">
<tal:daterange tal:define="from_date python:request.get('from_date');
                           to_date python:request.get('to_date')">
        <h1 class="documentFirstHeading" i18n:translate="title_orders">
        Orders
        </h1>
        <br/>
        <p><a tal:attributes="href string:${context/absolute_url}/order_manager/download_csv?from_date:date=${from_date}&amp;to_date:date=${to_date}">CSV export</a></p>

        <form action="./order_manager" method="post">
        <label for="from_date">From: </label>
        <input name="from_date:date" id="from_date"/>

        <label for="to_date">To: </label>
        <input name="to_date:date" id="to_date"/>

        <input name="filter" type="submit" value="Filter"/>
        <br/><br/>
        </form>


    <table class="padded-table">
    <thead>
        <th>ID</th>
        <th i18n:translate="label_order_title">Title</th>
        <th>Status</th>
        <th>Total</th>
        <th i18n:translate="label_cart">Cart</th>
        <th i18n:translate="label_customer">Customer</th>
        <th i18n:translate="label_date">Date</th>
    </thead>
    <tbody>
        <tr tal:repeat="order view/order_results">
            <td><a href="" tal:attributes="href string:order_view/${order/order_id}" tal:content="order/order_id"></a></td>
            <td tal:content="order/title"/>
            <td tal:content="order/status"/>
            <td tal:content="order/getTotal"/>
            <td><tal:block tal:repeat="item_set order/cartitems"><span tal:content="item_set/sku_code" /><span tal:content="string:(${item_set/quantity})" /><br/></tal:block></td>
            <td tal:define="customer string:${order/customer_firstname|nothing} ${order/customer_lastname|nothing}" 
                tal:content="customer"/>
            <td tal:content="python: order.date.strftime('%Y-%m-%d %H:%M')"/>
        </tr>
    </tbody>

    </table>

    <p><a tal:attributes="href string:${context/absolute_url}/order_manager/download_csv?from_date:date=${from_date}&amp;to_date:date=${to_date}">CSV export</a></p>

    <h3>Status Legend</h3>

    <ul>
        <li>1: ONLINE_PENDING</li>
        <li>2: ONLINE_CONFIRMED</li>
        <li>3: ONACCOUNT</li>
    </ul>

    <script>
        jq(function() {
            jq( "#from_date" ).datepicker();
            jq( "#to_date" ).datepicker();
        });
    </script>

</tal:daterange>
</metal:main>
</body>
</html>
