<tal:def i18n:domain="ftw.shop">
    <tal:shopitems repeat="item view/getItemDatas">

        <div class="listItem"
        	tal:define="normalizeString nocall: context/@@plone/normalizeString">
            
            <div class="listItemImage" tal:condition="item/imageTag">
                <a href="#" tal:attributes="href item/url">
                <img src="" tal:replace="structure item/imageTag" /></a>
            </div>

            <div class="listItemHeading">
                <h2><a href="#" tal:content="item/title" tal:attributes="href item/url" /></h2>
            </div>

            <p class="listItemBody">
                <span tal:replace="item/description" />
                <a href="#" tal:attributes="href item/url" i18n:translate="label_more_link">More</a>
            </p>
            
            
            <!-- Single Item with no Variations -->
            <div class="listItemTable" tal:condition="not:item/hasVariations">
                <table class="shopItemTable">
                    <tr>
                        <th i18n:translate="label_order_number">Order number</th>
                        <th colspan="2" i18n:translate="">Price</th>
                    </tr>
                    <tr>
                        <td tal:content="item/order_number" />
                        <td tal:content="item/price" />
                        <td>
                            <form tal:attributes="action string:${item/url}/addtocart">
                                <input type="hidden" name="skuCode" tal:attributes="value item/order_number"/>
                                <input type="text" size="2" name="quantity:int" value="1"/>
                                <input type="submit" value="Add to cart"/>
                                
                            </form>
                        </td>
                    </tr>
                </table>
            </div>



			<!-- One Variation Attribute -->
            <div class="variation-toplevel-group" 
                 tal:condition="python:item['hasVariations'] and len(varConf.getVariationAttributes()) == 1" 
			     tal:define="varConf item/varConf">
				<form tal:attributes="action string:${item/url}/addtocart">
					<fieldset>
						<legend>Bestellung</legend>
						<p>
							<label tal:content="python:varConf.getVariationAttributes()[0]">Farbe</label>
							<select name="var1choice">
								<option tal:repeat="varValue1 varConf/getVariation1Values"
									tal:content="varValue1" tal:attributes="value python:normalizeString(varValue1)">Blau</option>
							</select>
						</p>
						<p>
							<label>Menge</label>
							<input name="quantity:int" type="text" value="1" size="2" />
							<input type="submit" value="Add to cart" />
						</p>
					</fieldset>
				</form>
                 
                 <table id="itemDataTable" tal:define="varDict varConf/getVariationDict">
	                 <thead>
		                 <th>Variation</th><th>Price</th><th>Stock</th><th>SKU Code</th>
	                 </thead>
	                 <tbody>
		                 <tr tal:repeat="vkey varDict" tal:attributes="id vkey">
		                 <td tal:content="python:varConf.getPrettyName(vkey)"></td>
		                 <td tal:content="python: varDict[vkey]['price']"></td>
		                 <td tal:content="python: varDict[vkey]['stock']"></td>
		                 <td tal:content="python: varDict[vkey]['skuCode']"></td>
		                 </tr>
	                 </tbody>
                 </table>
             </div>


            
			<!-- Two Variation Attributes -->
            <div class="variation-toplevel-group" 
                 tal:condition="python:item['hasVariations'] and len(varConf.getVariationAttributes()) > 1" 
			     tal:define="varConf item/varConf">
				<form tal:attributes="action string:${item/url}/addtocart">
					<fieldset>
						<legend>Bestellung</legend>
						<p>
							<label tal:content="python:varConf.getVariationAttributes()[0]">Farbe</label>
							<select name="var1choice">
								<option tal:repeat="varValue1 varConf/getVariation1Values"
									tal:content="varValue1" tal:attributes="value python:normalizeString(varValue1)">Blau</option>
							</select>
						</p>
						<p>
							<label tal:content="python:varConf.getVariationAttributes()[1]">Gr√∂sse</label>
							<select name="var2choice">
								<option tal:repeat="varValue2 varConf/getVariation2Values"
									tal:content="varValue2" tal:attributes="value python:normalizeString(varValue2)">S</option>
							</select>
						</p>
						<p>
							<label>Menge</label>
							<input name="quantity:int" type="text" value="1" size="2" />
							<input type="submit" value="Add to cart" />
						</p>
					</fieldset>
				</form>
                 
                 <table id="itemDataTable" tal:define="varDict varConf/getVariationDict">
	                 <thead>
		                 <th></th><th>Price</th><th>Stock</th><th>SKU Code</th>
	                 </thead>
	                 <tbody>
		                 <tr tal:repeat="vkey varDict" tal:attributes="id vkey">
		                 <td tal:content="python:varConf.getPrettyName(vkey)"></td>
		                 <td tal:content="python: varDict[vkey]['price']"></td>
		                 <td tal:content="python: varDict[vkey]['stock']"></td>
		                 <td tal:content="python: varDict[vkey]['skuCode']"></td>
		                 </tr>
	                 </tbody>
                 </table>
             </div>

             <script type="text/javascript">
			    jq("select").change(function () {
			          var varkey;
			          if (jq("select[name=var2choice]").length == 0) {
				          varkey = jq("select[name=var1choice] option:selected").attr("value"); 
				      }
				      else {
				          varkey = jq("select[name=var1choice] option:selected").attr("value") + "-" + 
				          		   jq("select[name=var2choice] option:selected").attr("value"); 
				      }
				          jq("table#itemDataTable tr").hide();
				          jq("table#itemDataTable tr").each( function() {
				          		if (varkey == jq(this).attr("id")) {
				          			jq(this).show()
				          			}
				          		})
			     })
			     .change();
			</script>

             

         </div>
     </tal:shopitems>
</tal:def>
